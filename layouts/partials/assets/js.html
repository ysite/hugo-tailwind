{{- $src := .src }}
{{- $page := .page }}

{{- $js := "" }}

{{- if $page.Scratch.Get ( printf "%s" $src ) -}}
  {{- $js = ($page.Scratch.Get ( printf "%s" $src )) }}
{{- else -}}

  {{- $js = resources.Get ( printf "%s" $src )}}
  {{- if not hugo.IsProduction -}}
    {{- $js = $js | resources.ExecuteAsTemplate (replaceRE `(.*)(\.)` (printf "$1.dev.%v$2" now.UnixMilli) $src) $page -}}
  {{- else -}}
    {{- $js = $js | js.Build (dict "minify" "true" "format" $page.Site.Params.Jsformat ) | fingerprint "sha512" }}
  {{- end -}}

  {{- $page.Scratch.Set ( printf "%s" $src ) $js }}

{{- end -}}

{{- return $js }}
